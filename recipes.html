<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipes - LifeStyle Guide</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><h1>LifeStyle Guide</h1></header>
    <nav><ul id="navList"></ul></nav>

    <div class="container">
        <h2 style="text-align:center; color:#667eea; font-size:2.5em;">Share Your Recipe</h2>
        
        <div style="background:#f8f9fa; padding:30px; border-radius:20px; margin:30px 0;">
            <input type="text" id="recipeTitle" placeholder="Recipe Title" style="width:100%; padding:15px; font-size:1.2em; border-radius:15px; border:2px solid #667eea; margin-bottom:15px;">
            <textarea id="recipeDesc" placeholder="Ingredients & steps..." style="width:100%; height:150px; padding:15px; font-size:1.1em; border-radius:15px; border:2px solid #667eea; margin-bottom:15px;"></textarea>
            <input type="file" id="recipeImage" accept="image/*" style="margin-bottom:15px;">
            <button onclick="postRecipe()" class="btn btn-primary" style="width:100%; padding:18px; font-size:1.3em;">Post Recipe</button>
        </div>

        <h2 style="color:#667eea; margin-top:50px;">Your Recipes</h2>
        <div class="grid" id="recipesGrid"></div>
    </div>

    <div class="overlay" id="overlay">
        <div class="popup">
            <span class="close" onclick="document.getElementById('overlay').style.display='none'">Ã—</span>
            <img id="popupRecipeImg" style="width:100%; max-height:400px; object-fit:cover; border-radius:20px;">
            <h2 id="popupTitle" style="margin:25px 0; color:#667eea;"></h2>
            <p id="popupDesc" style="font-size:1.2em; line-height:1.8;"></p>
        </div>
    </div>

    <script>
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) { window.location.href = 'login.html'; }

        function postRecipe() {
            const title = document.getElementById('recipeTitle').value.trim();
            const desc = document.getElementById('recipeDesc').value.trim();
            const fileInput = document.getElementById('recipeImage');
            if (!title || !desc) return alert('Fill title and description!');

            const reader = new FileReader();
            if (fileInput.files[0]) {
                reader.onload = function(e) {
                    saveRecipe(e.target.result);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                saveRecipe("https://source.unsplash.com/random/600x400?" + encodeURIComponent(title));
            }

            function saveRecipe(imgSrc) {
                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.username === currentUser);
                user.savedRecipes.push({ title, desc, img: imgSrc });
                localStorage.setItem('users', JSON.stringify(users));
                loadRecipes();
                document.getElementById('recipeTitle').value = '';
                document.getElementById('recipeDesc').value = '';
                document.getElementById('recipeImage').value = '';
            }
        }

        function loadRecipes() {
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.username === currentUser);
            const grid = document.getElementById('recipesGrid');
            grid.innerHTML = '';
            user.savedRecipes.forEach(r => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${r.img}">
                    <h3>${r.title}</h3>
                `;
                div.onclick = () => {
                    document.getElementById('popupRecipeImg').src = r.img;
                    document.getElementById('popupTitle').textContent = r.title;
                    document.getElementById('popupDesc').textContent = r.desc;
                    document.getElementById('overlay').style.display = 'flex';
                };
                grid.appendChild(div);
            });
        }

        loadRecipes();
    </script>
    <script src="shared.js"></script>
</body>
</html>